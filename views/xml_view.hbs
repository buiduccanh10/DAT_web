<!DOCTYPE html>
<html>
<head>
    <title>Upload XML File</title>
    <style>
         .button-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        .pagination-button {
            padding: 8px 12px;
            background-color: #3498db;
            border: 1px solid #2980b9;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .pagination-button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Tải lên file XML danh sách học viên</h1>
    <form action="/uploadxml" method="post" enctype="multipart/form-data">
        <input type="file" name="file" required/>
        <button type="submit">Tải lên</button>
    </form>
    {{#if data}}
    <h2>XML Data:</h2>
    <div class="button-container">
                <button id="saveButton" class="pagination-button">Lưu</button>
    </div>
    <table border="1" id="data-table">
        <thead>
            <tr>
                <th>STT</th>
                <th>Mã Học Viên</th>
                <th>Khoá học</th>
                <th>Mã khoá học</th>
                <th>Họ Tên</th>
                <th>Ngày Sinh</th>
                <th>Giới Tính</th>
                <th>Số CMT</th>
                <th>Ngày Cấp CMT</th>
                <th>Nơi Cấp CMT</th>
                <th>Ngày Nhận Hồ Sơ</th>
                <th>Số GPLX</th>
                <th>Hạng GPLX</th>
                <th>Nơi Cấp GPLX</th>
                <th>Ảnh</th>
            </tr>
        </thead>
        <tbody>
            {{#each data}}
            <tr>
                <td>{{this.STT}}</td>
                <td>{{lookup this "Mã Học Viên"}}</td>
                <td>{{lookup this "Khoá học"}}</td>
                <td>{{lookup this "Mã khoá học"}}</td>
                <td>{{lookup this "Họ Tên"}}</td>
                <td>{{lookup this "Ngày Sinh"}}</td>
                <td>{{lookup this "Giới Tính"}}</td>
                <td>{{lookup this "Số CMT"}}</td>
                <td>{{lookup this "Ngày Cấp CMT"}}</td>
                <td>{{lookup this "Nơi Cấp CMT"}}</td>
                <td>{{lookup this "Ngày Nhận Hồ Sơ"}}</td>
                <td>{{lookup this "Số GPLX"}}</td>
                <td>{{lookup this "Hạng GPLX"}}</td>
                <td>{{lookup this "Nơi Cấp GPLX"}}</td>
                <td><img src="data:image/jpeg;base64,{{lookup this "Ảnh"}}" style="height: 130px; width:100px;" alt="Ảnh"></td>
            </tr>
            {{/each}}
        </tbody>
    </table>
    {{/if}}

    <script>
        document.getElementById('saveButton').addEventListener('click', function () {
            const rows = document.querySelectorAll('#data-table tbody tr');
            const data = [];

            rows.forEach(row => {
                const rowData = {
                    STT: row.cells[0].textContent,
                    MaHocVien: row.cells[1].textContent,
                    KhoaHoc:row.cells[2].textContent,
                    MaKhoaHoc:row.cells[3].textContent,
                    HoTen: row.cells[4].textContent,
                    NgaySinh: row.cells[5].textContent,
                    GioiTinh: row.cells[6].textContent,
                    SoCMT: row.cells[7].textContent,
                    NgayCapCMT: row.cells[8].textContent,
                    NoiCapCMT: row.cells[9].textContent,
                    NgayNhanHoSo: row.cells[10].textContent,
                    SoGPLX: row.cells[11].textContent,
                    HangGPLX: row.cells[12].textContent,
                    NoiCapGPLX: row.cells[13].textContent,
                    Anh: row.cells[14].querySelector('img').src.split(',')[1] // Get base64 string without data:image/jpeg;base64,
                };
                data.push(rowData);
            });

            fetch('/save-data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    alert('Data saved successfully!');
                } else {
                    alert('Error saving data.');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('Error saving data.');
            });
        });
    </script>
</body>
</html>

